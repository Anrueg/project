import { includeIgnoreFile } from "@eslint/compat"
import markdown from "@eslint/markdown"
import jsStylistic from "@stylistic/eslint-plugin-js"
import tsStylistic from "@stylistic/eslint-plugin-ts"
import tsPlugin from "@typescript-eslint/eslint-plugin"
import tsParser from "@typescript-eslint/parser"
import type { Linter } from "eslint"
import jsoncPlugin from "eslint-plugin-jsonc"
import prettierPluginConfig from "eslint-plugin-prettier/recommended"
import tomlPlugin from "eslint-plugin-toml"
import unusedImportsPlugin from "eslint-plugin-unused-imports"
import yamlPlugin from "eslint-plugin-yml"
import path from "node:path"
import { fileURLToPath } from "node:url"

const __filename = fileURLToPath(import.meta.url)
const __dirname = path.dirname(__filename)
const gitignorePath = path.resolve(__dirname, ".gitignore")

/* ! DO NOT EDIT ! */

export default [
    includeIgnoreFile(gitignorePath),
    ...(jsoncPlugin.configs["flat/prettier"] as any),
    ...yamlPlugin.configs["flat/prettier"],
    ...tomlPlugin.configs["flat/standard"],
    ...markdown.configs.recommended,
    {
        settings: {
            projectName: "{{ project_name }}",
            projectNs: "{{ project_slug }}",
            projectAbbrev: "{{ project_abbrev }}",
        }
    },
    {
        files: ["**/*.ts", "**/*.tsx"],
        plugins: {
            "@stylistic/js": jsStylistic,
            "@stylistic/ts": tsStylistic,
            "@typescript-eslint": tsPlugin,
            "unused-imports": unusedImportsPlugin
        },
        languageOptions: {
            parser: tsParser,
            parserOptions: {
                projectService: true,
                tsconfigRootDir: import.meta.dirname,
            }
        },
        rules: {
            // COMMON
            "arrow-body-style": ["error", "as-needed"],
            "eqeqeq": ["error", "always", { "null": "ignore" }],
            "yoda": ["error", "never", { exceptRange: true }],
            "no-alert": "error",
            "no-empty": "error",
            "prefer-arrow-callback": "error",
            "no-unused-vars": "off",
            // "no-unused-vars": ["error", {
            //     vars: "all",
            //     args: "after-used",
            //     argsIgnorePattern: "^_",
            //     caughtErrors: "all",
            //     destructuredArrayIgnorePattern: "^_",
            //     ignoreRestSiblings: true,
            //     ignoreClassWithStaticInitBlock: true
            // }],

            "unused-imports/no-unused-imports": "error",
            "unused-imports/no-unused-vars": [
                "error",
                {
                    vars: "all",
                    args: "after-used",
                    argsIgnorePattern: "^_",
                    caughtErrors: "all",
                    destructuredArrayIgnorePattern: "^_",
                    ignoreRestSiblings: true,
                    ignoreClassWithStaticInitBlock: true
                },
            ],

            // JAVASCRIPT
            "@stylistic/js/max-len": ["warn", { code: {{ line_width }} }],
            "@stylistic/js/quotes": ["error", "double", { "avoidEscape": true }],

            // TYPESCRIPT
            "@stylistic/ts/quotes": ["error", "double", { "avoidEscape": true }],
            "@stylistic/ts/quote-props": ["error", "consistent-as-needed"],

            "@typescript-eslint/no-unused-vars": "off",
            "@typescript-eslint/no-explicit-any": "off",
            "@typescript-eslint/no-non-null-assertion": "off",
            "@typescript-eslint/no-for-in-array": "error"
        }
    },
    {
        ...prettierPluginConfig,
        files: ["!**/*.toml"],
        rules: {
            ...prettierPluginConfig.rules,
            "prettier/prettier": [
                "error",
                {
                    semi: false,
                    trailingComma: "none",
                    arrowParens: "avoid",
                    quoteProps: "consistent",
                    bracketSpacing: true,
                    bracketSameLine: true,
                    htmlWhitespaceSensitivity: "ignore",
                    embeddedLanguageFormatting: "auto",
                    plugins: ["@trivago/prettier-plugin-sort-imports"],

                    // IMPORT SORT
                    importOrderSeparation: true,
                    importOrderSortSpecifiers: true,
                    importOrderCaseInsensitive: true,
                    importOrderParserPlugins: ["typescript", "decorators-legacy"],
                    importOrderImportAttributesKeyword: "with",
                    importOrderGroupNamespaceSpecifiers: true,
                    importOrder: [
                        "^node:.*?",
                        "^@angular/",
                        "^rxjs",
                        "<THIRD_PARTY_MODULES>",
                        "^@{{ project_slug }}/*",
                        "^[./]"
                    ]
                }
            ],
        },
    }
] satisfies Linter.Config[]
